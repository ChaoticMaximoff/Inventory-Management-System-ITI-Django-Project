{% extends "base.html" %} {% block title %} Shipments {% endblock title %}
{%block content %} {% if messages %} {% for message in messages %}
<div class="alert alert-danger alert-dismissible fade show" role="alert">
  {{ message }}
  <button
    type="button"
    class="btn-close"
    data-bs-dismiss="alert"
    aria-label="Close"
  ></button>
</div>
{% endfor %} {% endif %}

<h2>Shipments</h2>
<a href="{% url 'shipment_create' %}" class="btn btn-primary mb-3"
  >Create Shipment</a
>
<table class="table">
  <thead>
    <tr>
      <th>Factory</th>
      <th>Receive Date</th>
      <th>Confirmed</th>
      <th>Created By</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for shipment in shipments %}
    <tr>
      <td>{{ shipment.factory.name }}</td>
      <td>{{ shipment.receive_date }}</td>
      <td>{{ shipment.confirmed|yesno:"✅,❌" }}</td>
      <td>
        {% if shipment.created_by %} {{ shipment.created_by.username }} {%else%}
        <em>Unknown</em>
        {% endif %}
      </td>
      <td>
        <a
          href="{% url 'shipment_detail' shipment.id %}"
          class="btn btn-info btn-sm"
          >View</a
        >
        {% if not shipment.confirmed %}
        <button
          class="btn btn-danger btn-sm delete-shipment"
          data-shipment-id="{{ shipment.id }}"
        >
          Delete
        </button>
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="5">No shipments available.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% if is_paginated %}
<nav>
  <ul class="pagination">
    {% if page_obj.has_previous %}
    <li class="page-item">
      <a class="page-link" href="?page=1">⏮ First</a>
    </li>
    <li class="page-item">
      <a class="page-link" href="?page={{ page_obj.previous_page_number }}"
        >⬅ Previous</a
      >
    </li>
    {% endif %}
    <li class="page-item active">
      <span class="page-link"
        >Page {{ page_obj.number }} of {{ paginator.num_pages }}</span
      >
    </li>
    {% if page_obj.has_next %}
    <li class="page-item">
      <a class="page-link" href="?page={{ page_obj.next_page_number }}"
        >Next ➡</a
      >
    </li>
    <li class="page-item">
      <a class="page-link" href="?page={{ paginator.num_pages }}">Last ⏭</a>
    </li>
    {% endif %}
  </ul>
</nav>
{% endif %}

<!-- Delete Confirmation Modal -->
<div
  class="modal fade"
  id="deleteModal"
  tabindex="-1"
  aria-labelledby="deleteModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this shipment?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <form id="deleteForm" method="POST">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger">Delete</button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock content %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Get the modal element
    const deleteModal = document.getElementById("deleteModal");
    const deleteForm = document.getElementById("deleteForm");

    // Handle delete button clicks
    document.querySelectorAll(".delete-shipment").forEach((button) => {
      button.addEventListener("click", function (e) {
        e.preventDefault();
        const shipmentId = this.dataset.shipmentId;
        deleteForm.action = `/shipments/${shipmentId}/delete/`;
        let modal = new bootstrap.Modal(deleteModal);
        modal.show();
      });
    });
  });
</script>
{% endblock %}
